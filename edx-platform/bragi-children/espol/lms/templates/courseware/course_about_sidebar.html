<%namespace name='static' file='/static_content.html'/>

<%!
from django.utils.translation import gettext as _
from django.urls import reverse
from django.conf import settings
from lms.djangoapps.courseware.courses import get_course_about_section
from six import text_type, string_types
%>

<div class="course-summary">
  <div class="main-cta text-center">
    %if user.is_authenticated and registered:
      %if show_courseware_link:
      <a class="btn" href="${course_target}">
      %endif

      <span class="register disabled">${_("You are enrolled in this course")}</span>

      %if show_courseware_link:
        <strong>${_("View Course")}</strong>
        </a>
      %endif

    % elif is_course_full:
      <span class="register disabled">
        ${_("Course is full")}
      </span>
    % elif invitation_only and not can_enroll:
      <span class="register disabled">${_("Enrollment in this course is by invitation only")}</span>
      ## Shib courses need the enrollment button to be displayed even when can_enroll is False,
      ## because AnonymousUsers cause can_enroll for shib courses to be False, but we need them to be able to click
      ## so that they can register and become a real user that can enroll.
    % elif not is_shib_course and not can_enroll:
      <span class="register disabled">${_("Enrollment is Closed")}</span>
    %elif allow_anonymous:
      %if show_courseware_link:
        <a href="${course_target}">
          <strong>${_("View Course")}</strong>
        </a>
      %endif
    %else:
      <%
        if ecommerce_checkout:
          reg_href = ecommerce_checkout_link
        else:
          reg_href="#"
        if single_paid_mode:
          href_class = "add-to-cart"
        else:
          href_class = "register"
      %>
      <a href="${reg_href}" class="btn ${href_class}">
        ${_("Enroll")}
      </a>
      <div id="register_error"></div>
    %endif
  </div>

  <header class="mt-4 mb-0">
    % if static.get_value('course_about_show_social_links', True):
      <div class="social-sharing">
        <div class="sharing-message">${_("Share with friends and family!")}</div>
        ## TODO: this should probably be an overrideable block,
        ##       or something allowing themes to do whatever they
        ##       want here (and on this whole page, really).
          <%
            site_domain = static.get_value('site_domain', settings.SITE_NAME)
            platform_name = static.get_platform_name()

            ## Translators: This text will be automatically posted to the student's
            ## Twitter account. {url} should appear at the end of the text.
            tweet_text = _("I just enrolled in {number} {title} through {account}: {url}").format(
                number=course.number,
                title=course.display_name_with_default_escaped,
                account=static.get_value('course_about_twitter_account', settings.PLATFORM_TWITTER_ACCOUNT),
                url=u"http://{domain}{path}".format(
                    domain=site_domain,
                    path=reverse('about_course', args=[text_type(course.id)])
                )
            ).replace(u" ", u"+")
            tweet_action = u"http://twitter.com/intent/tweet?text={tweet_text}".format(tweet_text=tweet_text)

            facebook_link = static.get_value('course_about_facebook_link', settings.PLATFORM_FACEBOOK_ACCOUNT)

            email_subject = u"mailto:?subject={subject}&body={body}".format(
                subject=_("Take a course with {platform} online").format(platform=platform_name),
                body=_("I just enrolled in {number} {title} through {platform} {url}").format(
                    number=course.number,
                    title=course.display_name_with_default_escaped,
                    platform=platform_name,
                    url=u"http://{domain}{path}".format(
                        domain=site_domain,
                        path=reverse('about_course', args=[text_type(course.id)]),
                    )
                )
            ).replace(u" ", u"%20")
          %>
          <a href="${tweet_action}" class="share">
            <span class="icon fa fa-twitter" aria-hidden="true"></span><span class="sr">${_("Tweet that you've enrolled in this course")}</span>
          </a>
          <a href="${facebook_link}" class="share">
            <span class="icon fa fa-thumbs-up" aria-hidden="true"></span><span class="sr">${_("Post a Facebook message to say you've enrolled in this course")}</span>
          </a>
          <a href="${email_subject}" class="share">
            <span class="icon fa fa-envelope" aria-hidden="true"></span><span class="sr">${_("Email someone to say you've enrolled in this course")}</span>
          </a>
      </div>
    % endif
  </header>
  <%block name="course_about_important_dates">
  <ol class="important-dates">
    <li class="important-dates-item"><span class="icon fa fa-info-circle" aria-hidden="true"></span><p class="important-dates-item-title">${_("Course Number")}</p><span class="important-dates-item-text course-number">${course.display_number_with_default}</span></li>
    % if not course.start_date_is_still_default:
        <%
            course_start_date = course.advertised_start or course.start
        %>
      <li class="important-dates-item">
        <span class="icon fa fa-calendar" aria-hidden="true"></span>
        <p class="important-dates-item-title">${_("Classes Start")}</p>
        % if isinstance(course_start_date, string_types):
            <span class="important-dates-item-text start-date">${course_start_date}</span>
        % else:
            <%
               course_date_string = course_start_date.strftime('%Y-%m-%dT%H:%M:%S%z')
            %>
            <span class="important-dates-item-text start-date localized_datetime" data-format="shortDate" data-datetime="${course_date_string}" data-language="${LANGUAGE_CODE}"></span>
        % endif
      </li>
    % endif
      ## We plan to ditch end_date (which is not stored in course metadata),
      ## but for backwards compatibility, show about/end_date blob if it exists.
      % if course.end:
          <%
              course_end_date = course.end
          %>

      <li class="important-dates-item">
          <span class="icon fa fa-calendar" aria-hidden="true"></span>
          <p class="important-dates-item-title">${_("Classes End")}</p>
            % if isinstance(course_end_date, string_types):
                <span class="important-dates-item-text final-date">${course_end_date}</span>
            % else:
              <%
                  course_date_string = course_end_date.strftime('%Y-%m-%dT%H:%M:%S%z')
              %>
              <span class="important-dates-item-text final-date localized_datetime" data-format="shortDate" data-datetime="${course_date_string}" data-language="${LANGUAGE_CODE}"></span>
            % endif
      </li>
      % endif

    % if get_course_about_section(request, course, "effort"):
      <li class="important-dates-item"><span class="icon fa fa-pencil" aria-hidden="true"></span><p class="important-dates-item-title">${_("Estimated Effort")}</p><span class="important-dates-item-text effort">${get_course_about_section(request, course, "effort")}</span></li>
    % endif

    ##<li class="important-dates-item"><span class="icon fa fa-clock-o" aria-hidden="true"></span><p class="important-dates-item-title">${_('Course Length')}</p><span class="important-dates-item-text course-length">${_('{number} weeks').format(number=15)}</span></li>

    % if pre_requisite_courses:
    <% prc_target = reverse('about_course', args=[text_type(pre_requisite_courses[0]['key'])]) %>
    <li class="prerequisite-course important-dates-item">
      <span class="icon fa fa-list-ul" aria-hidden="true"></span>
      <p class="important-dates-item-title">${_("Prerequisites")}</p>
      ## Multiple pre-requisite courses are not supported on frontend that's why we are pulling first element
      <span class="important-dates-item-text pre-requisite"><a href="${prc_target}">${pre_requisite_courses[0]['display']}</a></span>
      <p class="tip">
      ${Text(_("You must successfully complete {link_start}{prc_display}{link_end} before you begin this course.")).format(
        link_start=HTML('<a href="{}">').format(prc_target),
        link_end=HTML('</a>'),
        prc_display=pre_requisite_courses[0]['display'],
      )}
      </p>
    </li>
    % endif

    % if get_course_about_section(request, course, "prerequisites"):
      <li class="important-dates-item"><span class="icon fa fa-book" aria-hidden="true"></span><p class="important-dates-item-title">${_("Requirements")}</p><span class="important-dates-item-text prerequisites">${get_course_about_section(request, course, "prerequisites")}</span></li>
    % endif
  </ol>
  </%block>
</div>

## CourseTalk widget
% if show_coursetalk_widget:
  <div class="coursetalk-read-reviews">
    <div id="ct-custom-read-review-widget" data-provider="${platform_key}" data-course="${course_review_key}"></div>
  </div>
% endif

## For now, ocw links are the only thing that goes in additional resources
% if get_course_about_section(request, course, "ocw_links"):
  <div class="additional-resources">
    <h1>${_("Additional Resources")}</h1>
  </div>

  <div>
    ## "MITOpenCourseware" should *not* be translated
    <h2 class="opencourseware">MITOpenCourseware</h2>
       ${get_course_about_section(request, course, "ocw_links")}
  </div>
%endif
